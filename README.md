Intensity Functional Principal Component Analysis (IFPCA)
================

## New Implementation

``` r
library(doParallel)
```

    ## Loading required package: foreach

    ## Loading required package: iterators

    ## Loading required package: parallel

``` r
url <- "https://raw.githubusercontent.com/celehs/MASTA/master/R/"
source(paste0(url, "masta-fpca-kern.R"))
source(paste0(url, "masta-fpca-main.R"))
source(paste0(url, "masta-fpca-ppic.R"))
source(paste0(url, "masta-fpca-pred.R"))
source("R/GetPK.R")
source("R/IFPCA.R")
```

``` r
i <- 3 # 1, 2, 3 
```

``` r
# time for each code (training + validation)
time_code <- readr::read_csv(paste0("data-raw/long/time_code", i, ".csv"))
```

    ## Parsed with column specification:
    ## cols(
    ##   id = col_double(),
    ##   month = col_double()
    ## )

``` r
time <- time_code$month
names(time) <- time_code$id
str(time)
```

    ##  Named num [1:21501] 37 37 38 38 39 39 40 40 41 41 ...
    ##  - attr(*, "names")= chr [1:21501] "6" "6" "6" "6" ...

``` r
# follow up time for training and validation sets
follow_up_train <- readr::read_csv("data-raw/long/follow_up_train.csv")
```

    ## Parsed with column specification:
    ## cols(
    ##   id = col_double(),
    ##   fu_time = col_double()
    ## )

``` r
follow_up_valid <- readr::read_csv("data-raw/long/follow_up_valid.csv")
```

    ## Parsed with column specification:
    ## cols(
    ##   id = col_double(),
    ##   fu_time = col_double()
    ## )

``` r
fu_train <- follow_up_train$fu_time
fu_valid <- follow_up_valid$fu_time
names(fu_train) <- follow_up_train$id
names(fu_valid) <- follow_up_valid$id
str(fu_train)
```

    ##  Named num [1:20600] 49.4 13.9 12.6 14.9 80.7 ...
    ##  - attr(*, "names")= chr [1:20600] "1" "2" "3" "4" ...

``` r
str(fu_valid)
```

    ##  Named num [1:500] 71.7 70.4 14.9 33.8 98.6 ...
    ##  - attr(*, "names")= chr [1:500] "90001" "90002" "90003" "90004" ...

``` r
system.time(NEW <- ifpca(time, fu_train, fu_valid)$FPCA)
```

    ##    user  system elapsed 
    ##  11.519   1.057   8.187

## Old Implementation

``` r
library(MASTA) 
```

    ## Loading required package: survival

    ## 
    ## Attaching package: 'MASTA'

    ## The following object is masked _by_ '.GlobalEnv':
    ## 
    ##     FPC.Kern.S

``` r
system.time(OLD <- masta.fpca(data_org)$FPCA[[i]])
```

    ## [1] "training: pred1"
    ## [1] "training: pred2"
    ## [1] "training: pred3"
    ## [1] "validation: pred1"
    ## [1] "validation: pred2"
    ## [1] "validation: pred3"

    ##    user  system elapsed 
    ## 109.130  10.418  77.118

## New vs Old Results

``` r
c(NEW$K, OLD$K)
```

    ## [1] 3 3

``` r
str(NEW$scores)
```

    ## 'data.frame':    5998 obs. of  11 variables:
    ##  $ id      : chr  "1" "2" "3" "4" ...
    ##  $ score_1 : num  0.0863 1.7192 -2.6026 1.3053 -1.4638 ...
    ##  $ score_2 : num  0.999 -0.154 -2.317 1.686 -0.569 ...
    ##  $ score_3 : num  -0.188338 0.000578 0.747628 -0.439457 0.293587 ...
    ##  $ score_4 : num  -1.046 1.302 0.801 -0.197 -0.451 ...
    ##  $ score_5 : num  0.3414 1.2492 -0.589 -0.2272 -0.0544 ...
    ##  $ score_6 : num  -0.104 -0.69 0.641 0.406 -0.665 ...
    ##  $ score_7 : num  -0.0857 0.3014 2.6718 0.9248 -2.414 ...
    ##  $ score_8 : num  -0.1933 -0.0408 -1.3456 0.4373 1.2886 ...
    ##  $ score_9 : num  0.161 0.236 0.418 -0.394 -0.439 ...
    ##  $ score_10: num  0.0799 0.2574 0.2118 -0.1484 -0.1655 ...

``` r
str(OLD$scores)
```

    ## 'data.frame':    5998 obs. of  11 variables:
    ##  $ id      : chr  "1" "2" "3" "4" ...
    ##  $ score_1 : num  0.0863 1.7192 -2.6026 1.3053 -1.4638 ...
    ##  $ score_2 : num  0.999 -0.154 -2.317 1.686 -0.569 ...
    ##  $ score_3 : num  -0.188338 0.000578 0.747628 -0.439457 0.293587 ...
    ##  $ score_4 : num  -1.046 1.302 0.801 -0.197 -0.451 ...
    ##  $ score_5 : num  0.3414 1.2492 -0.589 -0.2272 -0.0544 ...
    ##  $ score_6 : num  -0.104 -0.69 0.641 0.406 -0.665 ...
    ##  $ score_7 : num  -0.0857 0.3014 2.6718 0.9248 -2.414 ...
    ##  $ score_8 : num  -0.1933 -0.0408 -1.3456 0.4373 1.2886 ...
    ##  $ score_9 : num  0.161 0.236 0.418 -0.394 -0.439 ...
    ##  $ score_10: num  0.0799 0.2574 0.2118 -0.1484 -0.1655 ...

``` r
str(NEW$dens)
```

    ## 'data.frame':    401 obs. of  5999 variables:
    ##  $ x    : num  0 0.0025 0.005 0.0075 0.01 0.0125 0.015 0.0175 0.02 0.0225 ...
    ##  $ f1   : num  0 0 0 0 0 0 0 0 0 0 ...
    ##  $ f2   : num  0.0452 0.0517 0.0588 0.0664 0.0745 ...
    ##  $ f3   : num  0 0 0 0 0 0 0 0 0 0 ...
    ##  $ f4   : num  0.0053 0.00593 0.00658 0.00723 0.00785 ...
    ##  $ f5   : num  0 0 0 0 0 0 0 0 0 0 ...
    ##  $ f6   : num  0 0 0 0 0 0 0 0 0 0 ...
    ##  $ f7   : num  0.0193 0.022 0.0249 0.028 0.0312 ...
    ##  $ f8   : num  0 0 0 0 0 0 0 0 0 0 ...
    ##  $ f9   : num  0 0 0 0 0 0 0 0 0 0 ...
    ##  $ f10  : num  1.29e-04 1.77e-05 0.00 0.00 0.00 ...
    ##  $ f11  : num  0.0284 0.0324 0.0367 0.0414 0.0463 ...
    ##  $ f12  : num  0.00497 0.00553 0.00609 0.00662 0.00712 ...
    ##  $ f13  : num  0.128 0.147 0.168 0.19 0.214 ...
    ##  $ f14  : num  0.217 0.25 0.286 0.325 0.368 ...
    ##  $ f15  : num  0 0 0 0 0 0 0 0 0 0 ...
    ##  $ f16  : num  0 0 0 0 0 0 0 0 0 0 ...
    ##  $ f17  : num  0 0 0 0 0 0 0 0 0 0 ...
    ##  $ f18  : num  0.00657 0.00737 0.00819 0.00902 0.00982 ...
    ##  $ f19  : num  0 0 0 0 0 0 0 0 0 0 ...
    ##  $ f20  : num  0.0102 0.0115 0.0129 0.0144 0.0159 ...
    ##  $ f21  : num  0 0 0 0 0 0 0 0 0 0 ...
    ##  $ f22  : num  0 0 0 0 0 0 0 0 0 0 ...
    ##  $ f23  : num  0 0 0 0 0 0 0 0 0 0 ...
    ##  $ f24  : num  0.00255 0.00277 0.00296 0.00311 0.00319 ...
    ##  $ f25  : num  0 0 0 0 0 0 0 0 0 0 ...
    ##  $ f26  : num  0.00592 0.00663 0.00735 0.00806 0.00875 ...
    ##  $ f27  : num  0.00592 0.00661 0.00732 0.00802 0.00869 ...
    ##  $ f28  : num  0.0145 0.0164 0.0186 0.0208 0.0231 ...
    ##  $ f29  : num  0.0156 0.0177 0.02 0.0225 0.025 ...
    ##  $ f30  : num  1.28e-04 9.11e-06 0.00 0.00 0.00 ...
    ##  $ f31  : num  0 0 0 0 0 0 0 0 0 0 ...
    ##  $ f32  : num  0 0 0 0 0 0 0 0 0 0 ...
    ##  $ f33  : num  0 0 0 0 0 0 0 0 0 0 ...
    ##  $ f34  : num  0 0 0 0 0 0 0 0 0 0 ...
    ##  $ f35  : num  0 0 0 0 0 0 0 0 0 0 ...
    ##  $ f36  : num  0.0111 0.0125 0.0141 0.0158 0.0175 ...
    ##  $ f37  : num  0.0987 0.1135 0.1297 0.1474 0.1667 ...
    ##  $ f38  : num  0 0 0 0 0 0 0 0 0 0 ...
    ##  $ f39  : num  0 0 0 0 0 0 0 0 0 0 ...
    ##  $ f40  : num  0 0 0 0 0 0 0 0 0 0 ...
    ##  $ f41  : num  0 0 0 0 0 0 0 0 0 0 ...
    ##  $ f42  : num  0 0 0 0 0 0 0 0 0 0 ...
    ##  $ f43  : num  0 0 0 0 0 0 0 0 0 0 ...
    ##  $ f44  : num  0 0 0 0 0 0 0 0 0 0 ...
    ##  $ f45  : num  0 0 0 0 0 0 0 0 0 0 ...
    ##  $ f46  : num  0 0 0 0 0 0 0 0 0 0 ...
    ##  $ f47  : num  0.304 0.35 0.401 0.457 0.517 ...
    ##  $ f48  : num  0.0119 0.0135 0.0152 0.0169 0.0188 ...
    ##  $ f49  : num  0 0 0 0 0 0 0 0 0 0 ...
    ##  $ f50  : num  0 0 0 0 0 0 0 0 0 0 ...
    ##  $ f51  : num  0 0 0 0 0 0 0 0 0 0 ...
    ##  $ f52  : num  0.313 0.361 0.413 0.47 0.532 ...
    ##  $ f53  : num  0 0 0 0 0 0 0 0 0 0 ...
    ##  $ f54  : num  0 0 0 0 0 0 0 0 0 0 ...
    ##  $ f55  : num  0.00173 0.00184 0.00191 0.00192 0.00186 ...
    ##  $ f56  : num  0 0 0 0 0 0 0 0 0 0 ...
    ##  $ f57  : num  0.0117 0.0133 0.0149 0.0167 0.0185 ...
    ##  $ f58  : num  0 0 0 0 0 0 0 0 0 0 ...
    ##  $ f59  : num  0 0 0 0 0 0 0 0 0 0 ...
    ##  $ f60  : num  0 0 0 0 0 0 0 0 0 0 ...
    ##  $ f61  : num  0 0 0 0 0 0 0 0 0 0 ...
    ##  $ f62  : num  0.00147 0.00154 0.00158 0.00156 0.00147 ...
    ##  $ f63  : num  0 0 0 0 0 0 0 0 0 0 ...
    ##  $ f64  : num  0.000845 0.0009 0.000938 0.000951 0.00093 ...
    ##  $ f65  : num  0 0 0 0 0 0 0 0 0 0 ...
    ##  $ f66  : num  0.000449 0.000448 0.000425 0.000372 0.00028 ...
    ##  $ f67  : num  0 0 0 0 0 ...
    ##  $ f68  : num  0 0 0 0 0 0 0 0 0 0 ...
    ##  $ f69  : num  0 0 0 0 0 0 0 0 0 0 ...
    ##  $ f70  : num  0.136 0.156 0.177 0.201 0.227 ...
    ##  $ f71  : num  0 0 0 0 0 0 0 0 0 0 ...
    ##  $ f72  : num  0.0108 0.0124 0.0141 0.016 0.018 ...
    ##  $ f73  : num  0 0 0 0 0 0 0 0 0 0 ...
    ##  $ f74  : num  0 0 0 0 0 0 0 0 0 0 ...
    ##  $ f75  : num  0 0 0 0 0 0 0 0 0 0 ...
    ##  $ f76  : num  0.0389 0.0445 0.0506 0.0571 0.0641 ...
    ##  $ f77  : num  0 0 0 0 0 0 0 0 0 0 ...
    ##  $ f78  : num  0 0 0 0 0 0 0 0 0 0 ...
    ##  $ f79  : num  0 0 0 0 0 0 0 0 0 0 ...
    ##  $ f80  : num  0 0 0 0 0 0 0 0 0 0 ...
    ##  $ f81  : num  0 0 0 0 0 0 0 0 0 0 ...
    ##  $ f82  : num  0 0 0 0 0 0 0 0 0 0 ...
    ##  $ f83  : num  0 0 0 0 0 0 0 0 0 0 ...
    ##  $ f84  : num  0 0 0 0 0 0 0 0 0 0 ...
    ##  $ f85  : num  0 0 0 0 0 0 0 0 0 0 ...
    ##  $ f86  : num  0 0 0 0 0 0 0 0 0 0 ...
    ##  $ f87  : num  0 0 0 0 0 0 0 0 0 0 ...
    ##  $ f88  : num  0 0 0 0 0 0 0 0 0 0 ...
    ##  $ f89  : num  0 0 0 0 0 0 0 0 0 0 ...
    ##  $ f90  : num  0.00187 0.0021 0.00235 0.0026 0.00285 ...
    ##  $ f91  : num  0 0 0 0 0 0 0 0 0 0 ...
    ##  $ f92  : num  5.72e-06 0.00 0.00 0.00 0.00 ...
    ##  $ f93  : num  0 0 0 0 0 0 0 0 0 0 ...
    ##  $ f94  : num  0.0561 0.0641 0.0729 0.0823 0.0924 ...
    ##  $ f95  : num  0 0 0 0 0 0 0 0 0 0 ...
    ##  $ f96  : num  0 0 0 0 0 0 0 0 0 0 ...
    ##  $ f97  : num  0 0 0 0 0 0 0 0 0 0 ...
    ##  $ f98  : num  0.00161 0.00231 0.00323 0.00441 0.00592 ...
    ##   [list output truncated]

``` r
str(OLD$dens)
```

    ## 'data.frame':    401 obs. of  5999 variables:
    ##  $ x    : num  0 0.0025 0.005 0.0075 0.01 0.0125 0.015 0.0175 0.02 0.0225 ...
    ##  $ f1   : num  0 0 0 0 0 0 0 0 0 0 ...
    ##  $ f2   : num  0.0452 0.0517 0.0588 0.0664 0.0745 ...
    ##  $ f3   : num  0 0 0 0 0 0 0 0 0 0 ...
    ##  $ f4   : num  0.0053 0.00593 0.00658 0.00723 0.00785 ...
    ##  $ f5   : num  0 0 0 0 0 0 0 0 0 0 ...
    ##  $ f6   : num  0 0 0 0 0 0 0 0 0 0 ...
    ##  $ f7   : num  0.0193 0.022 0.0249 0.028 0.0312 ...
    ##  $ f8   : num  0 0 0 0 0 0 0 0 0 0 ...
    ##  $ f9   : num  0 0 0 0 0 0 0 0 0 0 ...
    ##  $ f10  : num  1.29e-04 1.77e-05 0.00 0.00 0.00 ...
    ##  $ f11  : num  0.0284 0.0324 0.0367 0.0414 0.0463 ...
    ##  $ f12  : num  0.00497 0.00553 0.00609 0.00662 0.00712 ...
    ##  $ f13  : num  0.128 0.147 0.168 0.19 0.214 ...
    ##  $ f14  : num  0.217 0.25 0.286 0.325 0.368 ...
    ##  $ f15  : num  0 0 0 0 0 0 0 0 0 0 ...
    ##  $ f16  : num  0 0 0 0 0 0 0 0 0 0 ...
    ##  $ f17  : num  0 0 0 0 0 0 0 0 0 0 ...
    ##  $ f18  : num  0.00657 0.00737 0.00819 0.00902 0.00982 ...
    ##  $ f19  : num  0 0 0 0 0 0 0 0 0 0 ...
    ##  $ f20  : num  0.0102 0.0115 0.0129 0.0144 0.0159 ...
    ##  $ f21  : num  0 0 0 0 0 0 0 0 0 0 ...
    ##  $ f22  : num  0 0 0 0 0 0 0 0 0 0 ...
    ##  $ f23  : num  0 0 0 0 0 0 0 0 0 0 ...
    ##  $ f24  : num  0.00255 0.00277 0.00296 0.00311 0.00319 ...
    ##  $ f25  : num  0 0 0 0 0 0 0 0 0 0 ...
    ##  $ f26  : num  0.00592 0.00663 0.00735 0.00806 0.00875 ...
    ##  $ f27  : num  0.00592 0.00661 0.00732 0.00802 0.00869 ...
    ##  $ f28  : num  0.0145 0.0164 0.0186 0.0208 0.0231 ...
    ##  $ f29  : num  0.0156 0.0177 0.02 0.0225 0.025 ...
    ##  $ f30  : num  1.28e-04 9.11e-06 0.00 0.00 0.00 ...
    ##  $ f31  : num  0 0 0 0 0 0 0 0 0 0 ...
    ##  $ f32  : num  0 0 0 0 0 0 0 0 0 0 ...
    ##  $ f33  : num  0 0 0 0 0 0 0 0 0 0 ...
    ##  $ f34  : num  0 0 0 0 0 0 0 0 0 0 ...
    ##  $ f35  : num  0 0 0 0 0 0 0 0 0 0 ...
    ##  $ f36  : num  0.0111 0.0125 0.0141 0.0158 0.0175 ...
    ##  $ f37  : num  0.0987 0.1135 0.1297 0.1474 0.1667 ...
    ##  $ f38  : num  0 0 0 0 0 0 0 0 0 0 ...
    ##  $ f39  : num  0 0 0 0 0 0 0 0 0 0 ...
    ##  $ f40  : num  0 0 0 0 0 0 0 0 0 0 ...
    ##  $ f41  : num  0 0 0 0 0 0 0 0 0 0 ...
    ##  $ f42  : num  0 0 0 0 0 0 0 0 0 0 ...
    ##  $ f43  : num  0 0 0 0 0 0 0 0 0 0 ...
    ##  $ f44  : num  0 0 0 0 0 0 0 0 0 0 ...
    ##  $ f45  : num  0 0 0 0 0 0 0 0 0 0 ...
    ##  $ f46  : num  0 0 0 0 0 0 0 0 0 0 ...
    ##  $ f47  : num  0.304 0.35 0.401 0.457 0.517 ...
    ##  $ f48  : num  0.0119 0.0135 0.0152 0.0169 0.0188 ...
    ##  $ f49  : num  0 0 0 0 0 0 0 0 0 0 ...
    ##  $ f50  : num  0 0 0 0 0 0 0 0 0 0 ...
    ##  $ f51  : num  0 0 0 0 0 0 0 0 0 0 ...
    ##  $ f52  : num  0.313 0.361 0.413 0.47 0.532 ...
    ##  $ f53  : num  0 0 0 0 0 0 0 0 0 0 ...
    ##  $ f54  : num  0 0 0 0 0 0 0 0 0 0 ...
    ##  $ f55  : num  0.00173 0.00184 0.00191 0.00192 0.00186 ...
    ##  $ f56  : num  0 0 0 0 0 0 0 0 0 0 ...
    ##  $ f57  : num  0.0117 0.0133 0.0149 0.0167 0.0185 ...
    ##  $ f58  : num  0 0 0 0 0 0 0 0 0 0 ...
    ##  $ f59  : num  0 0 0 0 0 0 0 0 0 0 ...
    ##  $ f60  : num  0 0 0 0 0 0 0 0 0 0 ...
    ##  $ f61  : num  0 0 0 0 0 0 0 0 0 0 ...
    ##  $ f62  : num  0.00147 0.00154 0.00158 0.00156 0.00147 ...
    ##  $ f63  : num  0 0 0 0 0 0 0 0 0 0 ...
    ##  $ f64  : num  0.000845 0.0009 0.000938 0.000951 0.00093 ...
    ##  $ f65  : num  0 0 0 0 0 0 0 0 0 0 ...
    ##  $ f66  : num  0.000449 0.000448 0.000425 0.000372 0.00028 ...
    ##  $ f67  : num  0 0 0 0 0 ...
    ##  $ f68  : num  0 0 0 0 0 0 0 0 0 0 ...
    ##  $ f69  : num  0 0 0 0 0 0 0 0 0 0 ...
    ##  $ f70  : num  0.136 0.156 0.177 0.201 0.227 ...
    ##  $ f71  : num  0 0 0 0 0 0 0 0 0 0 ...
    ##  $ f72  : num  0.0108 0.0124 0.0141 0.016 0.018 ...
    ##  $ f73  : num  0 0 0 0 0 0 0 0 0 0 ...
    ##  $ f74  : num  0 0 0 0 0 0 0 0 0 0 ...
    ##  $ f75  : num  0 0 0 0 0 0 0 0 0 0 ...
    ##  $ f76  : num  0.0389 0.0445 0.0506 0.0571 0.0641 ...
    ##  $ f77  : num  0 0 0 0 0 0 0 0 0 0 ...
    ##  $ f78  : num  0 0 0 0 0 0 0 0 0 0 ...
    ##  $ f79  : num  0 0 0 0 0 0 0 0 0 0 ...
    ##  $ f80  : num  0 0 0 0 0 0 0 0 0 0 ...
    ##  $ f81  : num  0 0 0 0 0 0 0 0 0 0 ...
    ##  $ f82  : num  0 0 0 0 0 0 0 0 0 0 ...
    ##  $ f83  : num  0 0 0 0 0 0 0 0 0 0 ...
    ##  $ f84  : num  0 0 0 0 0 0 0 0 0 0 ...
    ##  $ f85  : num  0 0 0 0 0 0 0 0 0 0 ...
    ##  $ f86  : num  0 0 0 0 0 0 0 0 0 0 ...
    ##  $ f87  : num  0 0 0 0 0 0 0 0 0 0 ...
    ##  $ f88  : num  0 0 0 0 0 0 0 0 0 0 ...
    ##  $ f89  : num  0 0 0 0 0 0 0 0 0 0 ...
    ##  $ f90  : num  0.00187 0.0021 0.00235 0.0026 0.00285 ...
    ##  $ f91  : num  0 0 0 0 0 0 0 0 0 0 ...
    ##  $ f92  : num  5.72e-06 0.00 0.00 0.00 0.00 ...
    ##  $ f93  : num  0 0 0 0 0 0 0 0 0 0 ...
    ##  $ f94  : num  0.0561 0.0641 0.0729 0.0823 0.0924 ...
    ##  $ f95  : num  0 0 0 0 0 0 0 0 0 0 ...
    ##  $ f96  : num  0 0 0 0 0 0 0 0 0 0 ...
    ##  $ f97  : num  0 0 0 0 0 0 0 0 0 0 ...
    ##  $ f98  : num  0.00161 0.00231 0.00323 0.00441 0.00592 ...
    ##   [list output truncated]

``` r
str(NEW$deriv)
```

    ## 'data.frame':    399 obs. of  5999 variables:
    ##  $ dx    : num  0.0025 0.005 0.0075 0.01 0.0125 0.015 0.0175 0.02 0.0225 0.025 ...
    ##  $ df1   : num  0 0 0 0 0 0 0 0 0 0 ...
    ##  $ df2   : num  2.71 2.94 3.16 3.36 3.54 ...
    ##  $ df3   : num  0 0 0 0 0 0 0 0 0 0 ...
    ##  $ df4   : num  0.256 0.258 0.253 0.239 0.214 ...
    ##  $ df5   : num  0 0 0 0 0 0 0 0 0 0 ...
    ##  $ df6   : num  0 0 0 0 0 0 0 0 0 0 ...
    ##  $ df7   : num  1.12 1.2 1.27 1.33 1.38 ...
    ##  $ df8   : num  0 0 0 0 0 0 0 0 0 0 ...
    ##  $ df9   : num  0 0 0 0 0 0 0 0 0 0 ...
    ##  $ df10  : num  -0.0258 -0.00355 0 0 0 ...
    ##  $ df11  : num  1.67 1.8 1.92 2.03 2.11 ...
    ##  $ df12  : num  0.223 0.219 0.207 0.184 0.149 ...
    ##  $ df13  : num  7.88 8.59 9.3 9.97 10.62 ...
    ##  $ df14  : num  13.7 15.1 16.5 17.8 19.2 ...
    ##  $ df15  : num  0 0 0 0 0 0 0 0 0 0 ...
    ##  $ df16  : num  0 0 0 0 0 0 0 0 0 0 ...
    ##  $ df17  : num  0 0 0 0 0 0 0 0 0 0 ...
    ##  $ df18  : num  0.324 0.329 0.327 0.313 0.288 ...
    ##  $ df19  : num  0 0 0 0 0 0 0 0 0 0 ...
    ##  $ df20  : num  0.548 0.575 0.593 0.601 0.596 ...
    ##  $ df21  : num  0 0 0 0 0 0 0 0 0 0 ...
    ##  $ df22  : num  0 0 0 0 0 0 0 0 0 0 ...
    ##  $ df23  : num  0 0 0 0 0 0 0 0 0 0 ...
    ##  $ df24  : num  0.082 0.0672 0.0446 0.013 -0.0288 ...
    ##  $ df25  : num  0 0 0 0 0 0 0 0 0 0 ...
    ##  $ df26  : num  0.285 0.287 0.281 0.265 0.237 ...
    ##  $ df27  : num  0.281 0.282 0.274 0.255 0.224 ...
    ##  $ df28  : num  0.813 0.864 0.906 0.937 0.954 ...
    ##  $ df29  : num  0.887 0.946 0.997 1.037 1.064 ...
    ##  $ df30  : num  -0.02558 -0.00182 0 0 0 ...
    ##  $ df31  : num  0 0 0 0 0 ...
    ##  $ df32  : num  0 0 0 0 0 0 0 0 0 0 ...
    ##  $ df33  : num  0 0 0 0 0 0 0 0 0 0 ...
    ##  $ df34  : num  0 0 0 0 0 0 0 0 0 0 ...
    ##  $ df35  : num  0 0 0 0 0 0 0 0 0 0 ...
    ##  $ df36  : num  0.611 0.646 0.673 0.69 0.695 ...
    ##  $ df37  : num  6.19 6.79 7.39 7.99 8.57 ...
    ##  $ df38  : num  0 0 0 0 0 0 0 0 0 0 ...
    ##  $ df39  : num  0 0 0 0 0 0 0 0 0 0 ...
    ##  $ df40  : num  0 0 0 0 0 0 0 0 0 0 ...
    ##  $ df41  : num  0 0 0 0 0 0 0 0 0 0 ...
    ##  $ df42  : num  0 0 0 0 0 0 0 0 0 0 ...
    ##  $ df43  : num  0 0 0 0 0 0 0 0 0 0 ...
    ##  $ df44  : num  0 0 0 0 0 0 0 0 0 0 ...
    ##  $ df45  : num  0 0 0 0 0 0 0 0 0 0 ...
    ##  $ df46  : num  0 0 0 0 0 0 0 0 0 0 ...
    ##  $ df47  : num  19.3 21.2 23.2 25.2 27.1 ...
    ##  $ df48  : num  0.659 0.697 0.728 0.748 0.756 ...
    ##  $ df49  : num  0 0 0 0 0 0 0 0 0 0 ...
    ##  $ df50  : num  0 0 0 0 0 0 0 0 0 0 ...
    ##  $ df51  : num  0 0 0 0 0 0 0 0 0 0 ...
    ##  $ df52  : num  19.9 21.9 23.9 26 28 ...
    ##  $ df53  : num  0 0 0 0 0 0 0 0 0 0 ...
    ##  $ df54  : num  0 0 0 0 0 0 0 0 0 0 ...
    ##  $ df55  : num  0.03432 0.01599 -0.00975 -0.04413 -0.08814 ...
    ##  $ df56  : num  0 0 0 0 0 0 0 0 0 0 ...
    ##  $ df57  : num  0.648 0.685 0.715 0.733 0.74 ...
    ##  $ df58  : num  0 0 0 0 0 0 0 0 0 0 ...
    ##  $ df59  : num  0 0 0 0 0 0 0 0 0 0 ...
    ##  $ df60  : num  0 0 0 0 0 0 0 0 0 0 ...
    ##  $ df61  : num  0 0 0 0 0 0 0 0 0 0 ...
    ##  $ df62  : num  0.02156 0.00307 -0.02247 -0.05623 -0.09913 ...
    ##  $ df63  : num  0 0 0 0 0 0 0 0 0 0 ...
    ##  $ df64  : num  0.01861 0.0102 -0.00175 -0.01785 -0.03855 ...
    ##  $ df65  : num  0 0 0 0 0 0 0 0 0 0 ...
    ##  $ df66  : num  -0.00492 -0.01522 -0.02895 -0.04666 -0.05596 ...
    ##  $ df67  : num  0 0 0 0.00292 0.04191 ...
    ##  $ df68  : num  0 0 0 0 0 0 0 0 0 0 ...
    ##  $ df69  : num  0 0 0 0 0 0 0 0 0 0 ...
    ##  $ df70  : num  8.38 9.15 9.91 10.66 11.37 ...
    ##  $ df71  : num  0 0 0 0 0 0 0 0 0 0 ...
    ##  $ df72  : num  0.658 0.715 0.77 0.822 0.87 ...
    ##  $ df73  : num  0 0 0 0 0 0 0 0 0 0 ...
    ##  $ df74  : num  0 0 0 0 0 0 0 0 0 0 ...
    ##  $ df75  : num  0 0 0 0 0 0 0 0 0 0 ...
    ##  $ df76  : num  2.33 2.52 2.71 2.87 3.02 ...
    ##  $ df77  : num  0 0 0 0 0 0 0 0 0 0 ...
    ##  $ df78  : num  0 0 0 0 0 0 0 0 0 0 ...
    ##  $ df79  : num  0 0 0 0 0 0 0 0 0 0 ...
    ##  $ df80  : num  0 0 0 0 0 0 0 0 0 0 ...
    ##  $ df81  : num  0 0 0 0 0 0 0 0 0 0 ...
    ##  $ df82  : num  0 0 0 0 0 0 0 0 0 0 ...
    ##  $ df83  : num  0 0 0 0 0 0 0 0 0 0 ...
    ##  $ df84  : num  0 0 0 0 0 0 0 0 0 0 ...
    ##  $ df85  : num  0 0 0 0 0 0 0 0 0 0 ...
    ##  $ df86  : num  0 0 0 0 0 0 0 0 0 0 ...
    ##  $ df87  : num  0 0 0 0 0 0 0 0 0 0 ...
    ##  $ df88  : num  0 0 0 0 0 0 0 0 0 0 ...
    ##  $ df89  : num  0 0 0 0 0 0 0 0 0 0 ...
    ##  $ df90  : num  0.0964 0.0994 0.1003 0.0985 0.0936 ...
    ##  $ df91  : num  0 0 0 0 0 0 0 0 0 0 ...
    ##  $ df92  : num  -0.00114 0 0 0 0 ...
    ##  $ df93  : num  0 0 0 0 0 0 0 0 0 0 ...
    ##  $ df94  : num  3.36 3.63 3.9 4.14 4.36 ...
    ##  $ df95  : num  0 0 0 0 0 0 0 0 0 0 ...
    ##  $ df96  : num  0 0 0 0 0 0 0 0 0 0 ...
    ##  $ df97  : num  0 0 0 0 0 0 0 0 0 0 ...
    ##  $ df98  : num  0.325 0.42 0.537 0.679 0.848 ...
    ##   [list output truncated]

``` r
str(OLD$deriv)
```

    ## 'data.frame':    399 obs. of  5999 variables:
    ##  $ dx    : num  0.0025 0.005 0.0075 0.01 0.0125 0.015 0.0175 0.02 0.0225 0.025 ...
    ##  $ df1   : num  0 0 0 0 0 0 0 0 0 0 ...
    ##  $ df2   : num  2.71 2.94 3.16 3.36 3.54 ...
    ##  $ df3   : num  0 0 0 0 0 0 0 0 0 0 ...
    ##  $ df4   : num  0.256 0.258 0.253 0.239 0.214 ...
    ##  $ df5   : num  0 0 0 0 0 0 0 0 0 0 ...
    ##  $ df6   : num  0 0 0 0 0 0 0 0 0 0 ...
    ##  $ df7   : num  1.12 1.2 1.27 1.33 1.38 ...
    ##  $ df8   : num  0 0 0 0 0 0 0 0 0 0 ...
    ##  $ df9   : num  0 0 0 0 0 0 0 0 0 0 ...
    ##  $ df10  : num  -0.0258 -0.00355 0 0 0 ...
    ##  $ df11  : num  1.67 1.8 1.92 2.03 2.11 ...
    ##  $ df12  : num  0.223 0.219 0.207 0.184 0.149 ...
    ##  $ df13  : num  7.88 8.59 9.3 9.97 10.62 ...
    ##  $ df14  : num  13.7 15.1 16.5 17.8 19.2 ...
    ##  $ df15  : num  0 0 0 0 0 0 0 0 0 0 ...
    ##  $ df16  : num  0 0 0 0 0 0 0 0 0 0 ...
    ##  $ df17  : num  0 0 0 0 0 0 0 0 0 0 ...
    ##  $ df18  : num  0.324 0.329 0.327 0.313 0.288 ...
    ##  $ df19  : num  0 0 0 0 0 0 0 0 0 0 ...
    ##  $ df20  : num  0.548 0.575 0.593 0.601 0.596 ...
    ##  $ df21  : num  0 0 0 0 0 0 0 0 0 0 ...
    ##  $ df22  : num  0 0 0 0 0 0 0 0 0 0 ...
    ##  $ df23  : num  0 0 0 0 0 0 0 0 0 0 ...
    ##  $ df24  : num  0.082 0.0672 0.0446 0.013 -0.0288 ...
    ##  $ df25  : num  0 0 0 0 0 0 0 0 0 0 ...
    ##  $ df26  : num  0.285 0.287 0.281 0.265 0.237 ...
    ##  $ df27  : num  0.281 0.282 0.274 0.255 0.224 ...
    ##  $ df28  : num  0.813 0.864 0.906 0.937 0.954 ...
    ##  $ df29  : num  0.887 0.946 0.997 1.037 1.064 ...
    ##  $ df30  : num  -0.02558 -0.00182 0 0 0 ...
    ##  $ df31  : num  0 0 0 0 0 ...
    ##  $ df32  : num  0 0 0 0 0 0 0 0 0 0 ...
    ##  $ df33  : num  0 0 0 0 0 0 0 0 0 0 ...
    ##  $ df34  : num  0 0 0 0 0 0 0 0 0 0 ...
    ##  $ df35  : num  0 0 0 0 0 0 0 0 0 0 ...
    ##  $ df36  : num  0.611 0.646 0.673 0.69 0.695 ...
    ##  $ df37  : num  6.19 6.79 7.39 7.99 8.57 ...
    ##  $ df38  : num  0 0 0 0 0 0 0 0 0 0 ...
    ##  $ df39  : num  0 0 0 0 0 0 0 0 0 0 ...
    ##  $ df40  : num  0 0 0 0 0 0 0 0 0 0 ...
    ##  $ df41  : num  0 0 0 0 0 0 0 0 0 0 ...
    ##  $ df42  : num  0 0 0 0 0 0 0 0 0 0 ...
    ##  $ df43  : num  0 0 0 0 0 0 0 0 0 0 ...
    ##  $ df44  : num  0 0 0 0 0 0 0 0 0 0 ...
    ##  $ df45  : num  0 0 0 0 0 0 0 0 0 0 ...
    ##  $ df46  : num  0 0 0 0 0 0 0 0 0 0 ...
    ##  $ df47  : num  19.3 21.2 23.2 25.2 27.1 ...
    ##  $ df48  : num  0.659 0.697 0.728 0.748 0.756 ...
    ##  $ df49  : num  0 0 0 0 0 0 0 0 0 0 ...
    ##  $ df50  : num  0 0 0 0 0 0 0 0 0 0 ...
    ##  $ df51  : num  0 0 0 0 0 0 0 0 0 0 ...
    ##  $ df52  : num  19.9 21.9 23.9 26 28 ...
    ##  $ df53  : num  0 0 0 0 0 0 0 0 0 0 ...
    ##  $ df54  : num  0 0 0 0 0 0 0 0 0 0 ...
    ##  $ df55  : num  0.03432 0.01599 -0.00975 -0.04413 -0.08814 ...
    ##  $ df56  : num  0 0 0 0 0 0 0 0 0 0 ...
    ##  $ df57  : num  0.648 0.685 0.715 0.733 0.74 ...
    ##  $ df58  : num  0 0 0 0 0 0 0 0 0 0 ...
    ##  $ df59  : num  0 0 0 0 0 0 0 0 0 0 ...
    ##  $ df60  : num  0 0 0 0 0 0 0 0 0 0 ...
    ##  $ df61  : num  0 0 0 0 0 0 0 0 0 0 ...
    ##  $ df62  : num  0.02156 0.00307 -0.02247 -0.05623 -0.09913 ...
    ##  $ df63  : num  0 0 0 0 0 0 0 0 0 0 ...
    ##  $ df64  : num  0.01861 0.0102 -0.00175 -0.01785 -0.03855 ...
    ##  $ df65  : num  0 0 0 0 0 0 0 0 0 0 ...
    ##  $ df66  : num  -0.00492 -0.01522 -0.02895 -0.04666 -0.05596 ...
    ##  $ df67  : num  0 0 0 0.00292 0.04191 ...
    ##  $ df68  : num  0 0 0 0 0 0 0 0 0 0 ...
    ##  $ df69  : num  0 0 0 0 0 0 0 0 0 0 ...
    ##  $ df70  : num  8.38 9.15 9.91 10.66 11.37 ...
    ##  $ df71  : num  0 0 0 0 0 0 0 0 0 0 ...
    ##  $ df72  : num  0.658 0.715 0.77 0.822 0.87 ...
    ##  $ df73  : num  0 0 0 0 0 0 0 0 0 0 ...
    ##  $ df74  : num  0 0 0 0 0 0 0 0 0 0 ...
    ##  $ df75  : num  0 0 0 0 0 0 0 0 0 0 ...
    ##  $ df76  : num  2.33 2.52 2.71 2.87 3.02 ...
    ##  $ df77  : num  0 0 0 0 0 0 0 0 0 0 ...
    ##  $ df78  : num  0 0 0 0 0 0 0 0 0 0 ...
    ##  $ df79  : num  0 0 0 0 0 0 0 0 0 0 ...
    ##  $ df80  : num  0 0 0 0 0 0 0 0 0 0 ...
    ##  $ df81  : num  0 0 0 0 0 0 0 0 0 0 ...
    ##  $ df82  : num  0 0 0 0 0 0 0 0 0 0 ...
    ##  $ df83  : num  0 0 0 0 0 0 0 0 0 0 ...
    ##  $ df84  : num  0 0 0 0 0 0 0 0 0 0 ...
    ##  $ df85  : num  0 0 0 0 0 0 0 0 0 0 ...
    ##  $ df86  : num  0 0 0 0 0 0 0 0 0 0 ...
    ##  $ df87  : num  0 0 0 0 0 0 0 0 0 0 ...
    ##  $ df88  : num  0 0 0 0 0 0 0 0 0 0 ...
    ##  $ df89  : num  0 0 0 0 0 0 0 0 0 0 ...
    ##  $ df90  : num  0.0964 0.0994 0.1003 0.0985 0.0936 ...
    ##  $ df91  : num  0 0 0 0 0 0 0 0 0 0 ...
    ##  $ df92  : num  -0.00114 0 0 0 0 ...
    ##  $ df93  : num  0 0 0 0 0 0 0 0 0 0 ...
    ##  $ df94  : num  3.36 3.63 3.9 4.14 4.36 ...
    ##  $ df95  : num  0 0 0 0 0 0 0 0 0 0 ...
    ##  $ df96  : num  0 0 0 0 0 0 0 0 0 0 ...
    ##  $ df97  : num  0 0 0 0 0 0 0 0 0 0 ...
    ##  $ df98  : num  0.325 0.42 0.537 0.679 0.848 ...
    ##   [list output truncated]

``` r
str(NEW$mean)
```

    ## 'data.frame':    401 obs. of  2 variables:
    ##  $ x   : num  0 0.0025 0.005 0.0075 0.01 0.0125 0.015 0.0175 0.02 0.0225 ...
    ##  $ f_mu: num  0.00138 0.0018 0.00233 0.00299 0.00381 ...

``` r
str(OLD$mean)
```

    ## 'data.frame':    401 obs. of  2 variables:
    ##  $ x   : num  0 0.0025 0.005 0.0075 0.01 0.0125 0.015 0.0175 0.02 0.0225 ...
    ##  $ f_mu: num  0.00138 0.0018 0.00233 0.00299 0.00381 ...

``` r
str(NEW$baseline)
```

    ##  num [1:10] -1.8945 0.4612 -0.1163 -0.102 0.0197 ...

``` r
str(OLD$baseline)
```

    ##  num [1:10] -1.8945 0.4612 -0.1163 -0.102 0.0197 ...

``` r
proc.time()
```

    ##    user  system elapsed 
    ## 123.266  11.619  88.468
