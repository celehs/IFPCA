---
title: "IFPCA"
output: github_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r}
library(tidyverse)
```

```{r}
Code <- bind_rows(
  Train = read_csv("demo/wide/TrainCode.csv"), 
  Valid = read_csv("demo/wide/ValidCode.csv"), .id = "split")
```

```{r}
fu_time <- Code %>% select(split, id, fu_time) %>% distinct()
write_csv(fu_time %>% filter(split == "Train"), "demo/long/fu_time_train.csv")
write_csv(fu_time %>% filter(split == "Valid"), "demo/long/fu_time_valid.csv")
```

```{r}
for (i in 1:3) {
  pred <- paste0("pred", i)
  path <- paste0("demo/long/time_code", i, ".csv")
  wide <- Code[c(Code[, pred] > 0), c("id", "month", pred)]
  freq <- wide[, pred][[1]]
  long <- tibble(
    id = rep(wide$id, freq),
    month = rep(wide$month, freq))
  write_csv(long, path)  
  print(path)  
}
```

```{r}
proc.time()
```
